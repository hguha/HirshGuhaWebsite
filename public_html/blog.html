<head>
  <link rel="stylesheet" href="css/blog.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.10.1/css/all.css">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans">
</head>
<body>
  <div id="sidebar">
    <img title="Back To Home" onclick="window.location.href='/'" src="images/hg-white.svg" class="logo">
    <div class="welcome">HIRSH'S BLOG</div>

    <p>Looking for some advice on tech? Money management? A place to eat? This blog has got you covered.</p>

    <div id="filter">
      <a class="active" data-filter="all">All</a>
      <a data-filter="review">Reviews</a>
      <a data-filter="tutorial">Tutorials</a>
      <a data-filter="advice">Advice</a>
      <a data-filter="recipe">Recipes</a>
    </div>


  </div>
  <div id="content"></div>

  <button onclick="toggleTheme()" id="theme-toggle">Dark Mode</button>
  
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
  <script>

    //THEME
    let themeColor = "#114499";
    var darkModeOn = false;
    let root = document.documentElement;
    function toggleTheme() {
      console.log("g");
      root.style.setProperty("--text-color", darkModeOn ? "#3c3c3c" : "#fff");
      root.style.setProperty("--background-color", darkModeOn ? "#fff" : "#3c3c3c");
      root.style.setProperty("--theme-color", themeColor = darkModeOn ? "#114499" :  "#00ccff");
      darkModeOn = !darkModeOn;
      document.getElementById("theme-toggle").innerHTML = darkModeOn ? "Light Mode" :  "Dark Mode";
    }


    let numBlogs = 0;

    async function getNumBlogs() {
      var counter = 1;
      while(true) {
            try {
                await $.get( "posts/post"+counter+".html", function() {
                  counter++;
                });
            } catch(ex) { return counter; }
        }
    }
    function generateListing() {
      $("#content").empty();
      for(let i = numBlogs; i > 0; i-- ) {
        $.get("posts/post"+Number(i)+".html", function( data ) {
          let title = $(data).filter("#title").html();
          let date = $(data).filter("#date").html();
          let tag = $(data).filter("#tag").html();
          let preview = $(data).filter("#body").html().slice(0,220);
          $("#content").append(`
          <div class="post" data-type="${tag}">
            <div class="title"><a onclick="loadBlog(${i})">${title}</a></div>
            <div class="date">${date}</div>
            <div class="preview">${preview}...</div>
            <hr style="margin-top:5%; height:1px; background-color:lightgray; border:none">
        </div>`);
      });
      }

      $filters = $('#filter [data-filter]');
              console.log($filters);
              $filters.on('click', function(e) {
                console.log($filters);
                console.log("dsa");
                var $cards = $('#content [data-type]');
                e.preventDefault();
                $filters.removeClass('active');
                $(this).addClass('active');

                var $filterType = $(this).attr('data-filter');

                if ($filterType == 'all') {
                    $cards.fadeOut(200).promise().done(function() {$cards.fadeIn(200);});
                } else {
                    $cards.fadeOut(200).promise().done(function() {
                        $cards.filter('[data-type = "' + $filterType + '"]').fadeIn(200);
                    });
                }
            });

    }

    function loadBlog(num) {
      $("#content").load(`posts/post${num}.html`, function() {
      $("#content").prepend(`<button class="back" onclick="generateListing()">&#8592; Back to Listing</button>`);
      });
    }

    window.onload = function() {
      getNumBlogs().then(function( data ) {
        numBlogs = data - 1;
        generateListing();
      });
    }

  </script> 
  
</body>

